##### 1.网络协议

###### 1.1 什么是计算机网络

* 计算机网络是指将地理位置不同的具有独立功能的多台计算机及其外部设备，通过有形或无形的通信线路连接起来，在网络操作系统、网络管理软件及网络通信协议的管理和协调下，实现资源共享和信息传递的计算机系统。

###### 1.2 什么是网络协议

* 网络协议是一种特殊的软件，是计算机网络实现其功能的最基本的机制。网络协议的本质就是规则，即各种硬件和软件必须遵守的共同规则。网络协议不是一套单独的软件，他融合于所涉及网络通信的软件甚至硬件之中，因此可以说协议在网络中无处不在。

###### 1.3 什么是协议栈？

* 为了减少网络设计的复杂性，绝大多数网络采用分层设计的方法。所谓分层设计，就是按照信息流动的过程将整个网络的整体功能分解为一个个的功能层，不同的机器上的同等功能层之间采用相同的协议，同一机器上相邻功能层之间通过接口信息进行信息传递。各层的协议和接口统称为协议栈。
* ISO（国际标准化组织）/OSI（开放系统互连）网络协议模型：
  * 应用层：业务逻辑
  * 表示层：数据的表示形式
  * 会话层：建立、管理和终止通信过程
  * 传输层：源到目的地的点对点传输
  * 网络层：路径选择、数据通道、错误检测等通信路径
  * 物理层：在数据和电平信号之间的转换

###### 1.4TCP/IP协议栈

* 传输层：TCP、UDP
* 网络层：IP、ICMP、IGMP
* 链路层：ARP、PARP

###### 1.5 消息包和数据流

* 应用层：HTTP请求=用户数据包
* 传输层：TCP头+用户数据包=TCP包
* 网络层：IP头+TCP头=IP包
* 链路层：以太网包头+IP包+以太网尾=以太网帧
* 物理层：以太网帧->电平信号
  * 发送数据流：消息自协议栈顶层向底层流动，逐层打包。
  * 接受数据流：消息自协议栈底层向顶层流动，逐层解析。

###### 1.6 IP地址

* IP地址（互联网协议地址）是一种地址格式，为互联网上的每个网络和主机分配一个逻辑地址，其目的是为了消除物理地址的差异性。IP地址的计算机内部用一个网络字节序的32位无符号整型表示。通常习惯将其表示为点分十进制整数字符串的形式。

* ```c
  点分十进制整数字符串：1.2.3.4
  内存布局：|0x01|0x02|0x03|0x04
  		低地址--------->高地址
  网络字节序就是大端字节序，高位在低地址，低位在高地址。
  ```

* 一台计算机的IP地址=网络地址+主机地址

  ```c
  A级地址：以0为首8位网络地址+24位主机地址
  B级地址：以10为首16位网络地址+16位主机地址
  C级地址：以110为首24位网络地址+8位主机地址
  D级地址：以1110为首的32为多(组)播地址
  ```

* 主机IP地址 & 子网掩码 = 网络地址
* 主机IP地址 & ~子网掩码 = 主机地址

##### 2.套接字

######  2.1 什么是套接字

* Socket套接字，一个由系统内核负责维护，通过文件描述符访问的对象，可用于同一台机器或不同机器中的进程之间的通信。

* 进程表项

  ```c
  文件描述符表
  0：文件描述符标志|*->标准输入文件表项->键盘
  1：文件描述符标志|*->标准输出文件表项->显示器
  2：文件描述符标志|*->套接字对象->网卡
      应用程序					应用程序
         v						 v
  磁盘文件的文件描述符 		    表述网络的文件描述符
         v						 v
      文件对象				   套接字对象
         v						 v
      文件系统				   网络协议栈
         v						 v	
      磁盘设备					网络设备
  套接字也可以被视为是围绕表示网络文件的文件描述符的一套函数库。调用其中的函数就可以访问网络上的数据，实现不同主机间的通信功能。
  ```

###### 2.2 绑定和连接

```c
套接字就是系统内核内存中的一块数据-----------逻辑对象
    								      |绑定（bind）
包含了IP地址和端口号等参数的网络设备----------物理对象
互联网
  |<-网络地址：192.168.182.0
子网络
  |<-主机地址：0.0.0.48
计算机
  |<-端口号：80
 应用
通过IP地址端口号就可以唯一定位互联网上的一个通信引用
主机A
应用程序
   |
逻辑对象（套接字）
   |绑定（bind）			     连接（connection）
物理对象（IP地址和端口号）--------物理对象（IP地址和端口号）
    								|绑定（bind）
   								 逻辑对象（套接字）
    								 |
    							   应用程序
    								主机B
```

##### 3.常用函数